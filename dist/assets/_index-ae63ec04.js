import{b as R,R as d,j as e,d as P,e as O,f as I,h as M,u as Q,c as S,r as ie,i as re,k as de,l as ce,m as ue}from"./index-76d0647a.js";import{e as me,b as pe,f as H,A as z,a as K,L as xe}from"./tour-ad82b6b2.js";import{c as N,G as _}from"./iconBase-2faace87.js";import{u as ge,M as E,A as L}from"./index.esm-dffc7106.js";import{a as he,b as fe}from"./index.esm-c19760e4.js";import{u as be,b as Z,c as je,d as ye,a as ve}from"./room-6bc17acc.js";import{_ as k,e as j,s as v}from"./PulseLoader-13df5752.js";import{b as we,c as Ne,d as F}from"./index.esm-ba32b841.js";import{P as $}from"./PannellumVideo-6fa3b5a9.js";const Se="",Ce=({isShow:a,onClose:n})=>{var m;const{idTour:o}=R(),{data:t}=ge(),{mutate:s,status:u}=be(),[c,i]=d.useState("Ruangan"),[g,l]=d.useState(null),h=r=>()=>l(r),p=()=>{n(),l(null)},f=()=>{if(!g){j({message:"Silahkan pilih gambar dahulu"});return}s({image_url:g,name:c,tour_id:String(o)},{onSuccess:()=>{v({message:"Behasil membuat ruangan baru"}),i("Ruangan"),l(null),p()},onError:()=>{j({message:"Gagal membuat ruangan"})}})};return e.jsx(E,{show:a,children:e.jsxs("div",{className:"bg-white rounded-sm px-4 w-5/12",children:[e.jsx("header",{className:"flex justify-end pt-3","aria-label":"modal-head",children:e.jsx("button",{disabled:u==="loading",type:"button",onClick:p,children:e.jsx(L,{className:"text-lg"})})}),e.jsxs("div",{className:"py-4","aria-label":"modal-body",children:[e.jsx("div",{className:"max-h-[330px] overflow-auto","aria-label":"images-container",children:e.jsx("div",{className:"grid grid-cols-2 gap-3 pr-2","aria-label":"images-wrapper",children:(m=t==null?void 0:t.data)==null?void 0:m.map((r,b)=>e.jsxs("div",{className:N("col-span-1 cursor-pointer relative"),onClick:h(r.file_path),children:[e.jsx("img",{src:Se+(r==null?void 0:r.thumbnail_path),alt:"avatar",loading:"lazy"}),g===r.file_path&&e.jsx("div",{className:"absolute inset-0 bg-black/60 z-10 flex justify-center items-center","aria-label":"selected-overlay",children:e.jsx("div",{className:"bg-white flex flex-col justify-center items-center rounded-full p-1",children:e.jsx(he,{className:"text-4xl text-blue-600"})})})]},b))})}),e.jsxs("div",{className:"mt-3 px-3","aria-label":"submit-container",children:[e.jsxs("div",{className:"text-white",children:[e.jsx("label",{htmlFor:"tour-name",className:"text-sm",children:"Tour name"}),e.jsx("input",{id:"tour-name",type:"text",className:N("border-gray-300 focus:border-gray-300 focus:ring-0 px-4 text-gray-900","focus:outline-none w-full tracking-wide rounded-md","placeholder:font-medium placeholder:tracking-wide placeholder:text-gray-400","peer/search"),value:c,onChange:r=>i(r.target.value)})]}),e.jsx("button",{disabled:u==="loading",type:"button",onClick:f,className:"bg-blue-500 relative text-white w-full px-3 py-2 rounded-md font-medium mt-4",children:u==="loading"?e.jsx(k,{color:"white",size:10}):"Simpan"})]})]})]})})},ke=d.memo(()=>{const{idTour:a}=R(),{data:n}=me({tour_id:String(a)}),[o,t]=d.useState("");d.useEffect(()=>{t((n==null?void 0:n.data.name)??"")},[n==null?void 0:n.data.name]);const{mutate:s,status:u}=pe(),c=()=>{const i=new FormData;i.append("name",o),i.append("_method","PUT"),s({tour_id:String(a),payload:i},{onSuccess:()=>{v({message:"Success update tour"})},onError:()=>{j({message:"Failed update tour"})}})};return e.jsxs("div",{className:"mt-3 px-3","aria-label":"submit",children:[e.jsxs("div",{className:"text-white",children:[e.jsx("label",{htmlFor:"tour-name",className:"text-sm",children:"Tour name"}),e.jsx("input",{id:"tour-name",type:"text",className:N("border-gray-300 focus:border-gray-300 focus:ring-0 px-4 text-gray-900","focus:outline-none w-full tracking-wide rounded-md","placeholder:font-medium placeholder:tracking-wide placeholder:text-gray-400","peer/search"),value:o,onChange:i=>t(i.target.value)})]}),e.jsx("button",{onClick:c,disabled:u==="loading",className:"bg-blue-500 relative text-white w-full px-3 py-2 rounded-md font-medium mt-4",children:u==="loading"?e.jsx(k,{color:"white",size:10}):"Simpan"})]})});P({key:"scene",default:[]});P({key:"scene-menu",default:null});const D=P({key:"viewer-coordinate",default:{pitch:0,yaw:0}}),B=P({key:"initial-viewer-coordinate",default:{pitch:0,yaw:0}}),J=()=>{const a=O();return H({mutationFn:async o=>{const t=new FormData;return t.append("tour_id",String(o.tour_id)),t.append("room_id",String(o.room_id)),t.append("pitch",String(o.pitch)),t.append("yaw",String(o.yaw)),t.append("type",String(o.type)),t.append("text",String(o.text??"")),(await z.post("/api/hotspot",t)).data},onSuccess:()=>a.invalidateQueries(["HOTSPOTS"])})},G=()=>{const a=O();return H({mutationFn:async o=>(await z.post(`/api/hotspot/${o.hostpot_id}`,o.payload,{headers:{"content-type":"application/x-www-form-urlencoded"}})).data,onSuccess:()=>a.invalidateQueries(["HOTSPOTS"])})},U=()=>{const a=O();return H({mutationFn:async({hostpot_id:o})=>(await z.delete(`/api/hotspot/${o}`)).data,onSuccess:()=>a.invalidateQueries(["HOTSPOTS"])})};function _e(a){return _({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M288 144a110.94 110.94 0 0 0-31.24 5 55.4 55.4 0 0 1 7.24 27 56 56 0 0 1-56 56 55.4 55.4 0 0 1-27-7.24A111.71 111.71 0 1 0 288 144zm284.52 97.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400c-98.65 0-189.09-55-237.93-144C98.91 167 189.34 112 288 112s189.09 55 237.93 144C477.1 345 386.66 400 288 400z"}}]})(a)}function Re(a){return _({tag:"svg",attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"}}]})(a)}function Me(a){return _({tag:"svg",attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"}}]})(a)}function Te(a){return _({tag:"svg",attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"}}]})(a)}function Pe(a){return _({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 464c114.9 0 208-93.1 208-208S370.9 48 256 48 48 141.1 48 256s93.1 208 208 208zm0-244.5l-81.1 81.9c-7.5 7.5-19.8 7.5-27.3 0s-7.5-19.8 0-27.3l95.7-95.4c7.3-7.3 19.1-7.5 26.6-.6l94.3 94c3.8 3.8 5.7 8.7 5.7 13.7 0 4.9-1.9 9.9-5.6 13.6-7.5 7.5-19.7 7.6-27.3 0l-81-79.9z"}}]})(a)}function Ie(a){return _({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M416 277.333H277.333V416h-42.666V277.333H96v-42.666h138.667V96h42.666v138.667H416v42.666z"}}]})(a)}const Oe=({isShow:a,onClose:n})=>{const[o]=I(),{idTour:t}=R(),s=o.get("roomId"),{mutate:u,status:c}=J(),i=M.useRecoilValue(D),g=M.useSetRecoilState(B),[l,h]=d.useState(""),p=m=>{h(m.target.value)},f=()=>{if(!l){j({message:"Nama label tidak boleh kosong"});return}u({pitch:i.pitch,yaw:i.yaw,type:"label",tour_id:String(t),room_id:String(s),text:l},{onSuccess:m=>{try{m.success&&v({message:"Berhasil menambah label"})}catch{j({message:"Gagal menambah label"})}finally{n()}},onError:()=>{j({message:"Gagal menambah label"})}}),g({pitch:i.pitch,yaw:i.yaw})};return e.jsx(E,{show:a,children:e.jsxs("div",{className:"bg-white rounded-sm px-4 w-3/12",children:[e.jsx("header",{className:"flex justify-end pt-3","aria-label":"modal-head",children:e.jsx("button",{disabled:c==="loading",type:"button",onClick:n,children:e.jsx(L,{className:"text-lg"})})}),e.jsx("div",{className:"mb-5","aria-label":"modal-body",children:e.jsxs("div",{className:"px-3","aria-label":"submit-container",children:[e.jsxs("div",{className:"text-black flex flex-col gap-1",children:[e.jsx("label",{htmlFor:"room-name",children:"Label name"}),e.jsx("input",{id:"room-name",type:"text",className:N("border-gray-300 focus:border-gray-300 focus:ring-0 px-4 text-gray-900","focus:outline-none w-full tracking-wide rounded-md","placeholder:font-medium placeholder:tracking-wide placeholder:text-gray-400","peer/search"),value:l,onChange:p})]}),e.jsx("button",{disabled:c==="loading",type:"button",onClick:f,className:"bg-blue-500 relative text-white w-full px-3 py-2 rounded-md font-medium mt-4",children:c==="loading"?e.jsx(k,{color:"white",size:10}):"Simpan"})]})})]})})},He=d.memo(()=>{const[a]=I(),{idTour:n}=R(),o=a.get("roomId"),{mutate:t,status:s}=J(),{mutate:u,status:c}=Z(),i=M.useRecoilValue(D),[g,l]=d.useState(null),[h,p]=d.useState(!1),f=d.useCallback(y=>()=>{if(y==="open")return p(!0);if(y==="close")return p(!1)},[]),m=M.useSetRecoilState(B),r=()=>{const y=new FormData;y.append("pitch",String(i.pitch)),y.append("yaw",String(i.yaw)),y.append("_method","PUT"),u({room_id:String(o),payload:y},{onSuccess:()=>{v({message:"Berhasil update initial view"})},onError:()=>{j({message:"Gagal update initial view"})}})},b=y=>()=>{l(y),t({pitch:i.pitch,yaw:i.yaw,type:y,tour_id:String(n),room_id:String(o)},{onSuccess:()=>{v({message:"Berhasil menambah hotspot"}),l(null)},onError:()=>{j({message:"Gagal menambah hotspot"}),l(null)}}),m({pitch:i.pitch,yaw:i.yaw})};return e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"text-white py-1","aria-label":"tools",children:[e.jsx("h3",{className:"text-[.85rem] font-semibold px-5 text-gray-300",children:"TOOLS"}),e.jsxs("div",{className:"mt-2 flex flex-col gap-[3px]","aria-label":"btn-action-contianer",children:[e.jsx("button",{className:N("flex items-center gap-3 px-5 w-full py-[10px]","bg-gray-700 hover:bg-gray-600 transition"),type:"button",onClick:b("info"),disabled:s==="loading",children:s==="loading"&&g==="info"?e.jsx(k,{color:"white",size:10,className:"mx-auto py-[5px]"}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"text-2xl"}),e.jsx("p",{children:"Tambah Text"})]})}),e.jsxs("button",{className:N("flex items-center gap-3 px-5 w-full py-[10px]","bg-gray-700 hover:bg-gray-600 transition"),onClick:f("open"),type:"button",children:[e.jsx(fe,{className:"text-2xl"}),e.jsx("p",{children:"Tambah Label"})]}),e.jsx("button",{className:N("flex items-center gap-3 px-5 w-full py-[10px] bg-gray-700 hover:bg-gray-600 transition"),type:"button",onClick:b("custom"),disabled:s==="loading",children:s==="loading"&&g==="custom"?e.jsx(k,{color:"white",size:10,className:"mx-auto py-[5px]"}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"text-2xl"}),e.jsx("p",{children:"Tambah Hotspot"})]})}),e.jsx("button",{onClick:r,className:"flex items-center gap-3 px-5 w-full py-[10px] bg-gray-700",type:"button",disabled:c==="loading",children:c==="loading"?e.jsx(k,{color:"white",size:10,className:"mx-auto py-[5px]"}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"text-2xl"}),e.jsx("p",{children:"Tetapkan view awal"})]})})]})]}),e.jsx(Oe,{isShow:h,onClose:f("close")})]})});function ze(a){return _({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M231.4,44.34s0,.1,0,.15l-58.2,191.94a15.88,15.88,0,0,1-14,11.51q-.69.06-1.38.06a15.86,15.86,0,0,1-14.42-9.15l-35.71-75.39a4,4,0,0,1,.79-4.54l57.26-57.27a8,8,0,0,0-11.31-11.31L97.08,147.6a4,4,0,0,1-4.54.79l-75-35.53A16.37,16.37,0,0,1,8,97.36,15.89,15.89,0,0,1,19.57,82.84l191.94-58.2.15,0A16,16,0,0,1,231.4,44.34Z"}}]})(a)}const Ee=d.memo(({onShowModal:a,onShowRoomPanel:n})=>{const[o]=I(),t=Q(),{idTour:s}=R(),u=o.get("roomId"),{data:c}=K({id:String(s)}),i=d.useMemo(()=>c==null?void 0:c.data,[c==null?void 0:c.data]),g=l=>()=>t(`/editor/${s}?roomId=${l}`);return e.jsxs("section",{className:"mt-2","aria-label":"ruangan",children:[e.jsxs("header",{className:"flex items-center justify-between pr-4",children:[e.jsx("h3",{className:"text-[.85rem] font-semibold px-5 text-gray-300",children:"RUANGAN"}),e.jsx("button",{className:"border border-white rounded-md p-[.4rem]",onClick:a,children:e.jsx(Ie,{className:"text-white"})})]}),e.jsx("div",{className:"max-h-[300px] overflow-auto mt-2","aria-label":"list-ruangan-container",children:e.jsx("div",{className:"text-white flex flex-col gap-[3px]","aria-label":"list-ruangan-wrapper",children:i==null?void 0:i.map((l,h)=>e.jsxs("button",{className:N("flex items-center justify-between px-5 w-full py-3 relative",String(u)===l.id?"bg-gray-600":"bg-gray-700"),type:"button",onClick:g(l.id),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ze,{className:"text-lg"}),e.jsx("p",{className:"",children:l.name})]}),e.jsx("div",{role:"button",tabIndex:0,onClick:n({room_id:l.id,room_name:l.name}),children:e.jsx(Me,{className:"text-2xl"})})]},h))})})]})}),Le=(a,n)=>(d.useEffect(()=>{const o=t=>{a.current&&!a.current.contains(t.target)&&n()};return document.addEventListener("click",o),()=>{document.removeEventListener("click",o)}},[n,a]),a);function Fe(a){return _({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",stroke:"#000",strokeWidth:"2",d:"M7,7 L17,17 M7,17 L17,7"}}]})(a)}const De=({isShow:a,room:n,onClose:o})=>{const{mutate:t,status:s}=Z(),[u,c]=d.useState(n.name);d.useEffect(()=>{c(n.name)},[n.name]);const i=l=>{const h=l.target.value;h.length>=17||c(h)},g=()=>{if(u.length===0){j({message:"Nama tidak boleh kosong!"});return}const l=new FormData;l.append("name",u),l.append("_method","PUT"),t({room_id:n.id,payload:l},{onSuccess:()=>{v({message:"Behasil update nama ruangan"}),o()},onError:()=>{j({message:"Gagal update nama ruangan"})}})};return e.jsx(E,{show:a,children:e.jsxs("div",{className:"bg-white rounded-md px-4 w-4/12",children:[e.jsx("header",{className:"flex justify-end pt-3","aria-label":"modal-head",children:e.jsx("button",{disabled:s==="loading",type:"button",onClick:o,children:e.jsx(L,{className:"text-lg"})})}),e.jsx("div",{className:"mb-5","aria-label":"modal-body",children:e.jsxs("div",{className:"px-3","aria-label":"submit-container",children:[e.jsxs("div",{className:"text-black flex flex-col gap-1",children:[e.jsx("label",{htmlFor:"room-name",children:"Room name"}),e.jsx("input",{id:"room-name",type:"text",className:N("border-gray-300 focus:border-gray-300 focus:ring-0 px-4 text-gray-900","focus:outline-none w-full tracking-wide rounded-md","placeholder:font-medium placeholder:tracking-wide placeholder:text-gray-400","peer/search"),value:u,onChange:i})]}),e.jsx("button",{disabled:s==="loading",type:"button",onClick:g,className:"bg-blue-500 relative text-white w-full px-3 py-2 rounded-md font-medium mt-4",children:s==="loading"?e.jsx(k,{color:"white",size:10}):"Simpan Perubahan"})]})})]})})},Be=({tourId:a,roomId:n,roomName:o,coordinateX:t,coordinateY:s,onClose:u})=>{const c=d.useRef(null),i=Q(),[g,l]=d.useState(!1),{mutate:h,status:p}=je(),f=r=>()=>{if(r==="show"){l(!0);return}r==="close"&&l(!1)},m=()=>{confirm("Yakin ingin menghapus ruangan ini ?")&&h({room_id:n},{onSuccess:()=>{v({message:"Berhasil menghapus ruangan"}),i(`/editor/${a}`),u()},onError:()=>{j({message:"Gagal menghapus ruangan"})}})};return Le(c,g?()=>{}:u),e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:c,onClick:r=>r.stopPropagation(),style:{position:"fixed",zIndex:"49",left:t+10,top:s+10},className:"bg-gray-100 rounded-md w-max shadow-md relative",children:[e.jsx("button",{type:"button",className:"absolute -top-4 -right-4 bg-gray-100 shadow-lg rounded-md",onClick:u,children:e.jsx(Fe,{className:"text-2xl"})}),e.jsxs("div",{className:"rounded-md overflow-hidden p-1 flex flex-col","aria-label":"panel-body",children:[e.jsx("button",{type:"button",className:"py-3 px-3 hover:bg-gray-200 transition rounded-md",onClick:f("show"),children:e.jsxs("div",{className:"flex justify-start items-center gap-3",children:[e.jsx(Te,{}),e.jsx("p",{children:"Ubah nama Ruangan"})]})}),e.jsx("button",{onClick:m,disabled:p==="loading",type:"button",className:"py-3 px-3 hover:bg-gray-200 transition rounded-md",children:p==="loading"?e.jsx(k,{color:"skyblue",size:10}):e.jsxs("div",{className:"flex justify-start items-center gap-3",children:[e.jsx(we,{}),e.jsx("p",{children:"Hapus Ruangan"})]})})]})]}),e.jsx(De,{isShow:g,room:{id:n,name:o},onClose:f("close")})]})},W={addRoom:!1},Ge=()=>{const{idTour:a}=R(),[n,o]=d.useState(W),[t,s]=d.useState({id:null,name:""}),[u,c]=d.useState({x:0,y:0}),i=d.useCallback(p=>()=>{switch(p){case"addRoom":o({addRoom:!0});break}},[]),g=d.useCallback(({room_id:p,room_name:f})=>m=>{m.stopPropagation();const r={x:m.clientX,y:m.clientY};s({id:p,name:f}),c(r)},[]),l=()=>s({id:null,name:""}),h=d.useCallback(()=>o(W),[]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:N("col-span-2 bg-gray-800 pt-2 pb-5","min-h-[calc(100vh_-_60px)] flex flex-col justify-between"),children:[e.jsxs("div",{"aria-label":"top-side",children:[e.jsx(He,{}),e.jsx(Ee,{onShowModal:i("addRoom"),onShowRoomPanel:g})]}),e.jsx(ke,{})]}),t.id&&e.jsx(Be,{tourId:String(a),roomId:t.id,roomName:t.name,coordinateX:u.x,coordinateY:u.y,onClose:l}),e.jsx(Ce,{isShow:n.addRoom,onClose:h})]})};var ee={},T=S&&S.__assign||function(){return T=Object.assign||function(a){for(var n,o=1,t=arguments.length;o<t;o++){n=arguments[o];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(a[s]=n[s])}return a},T.apply(this,arguments)},Ue=S&&S.__createBinding||(Object.create?function(a,n,o,t){t===void 0&&(t=o);var s=Object.getOwnPropertyDescriptor(n,o);(!s||("get"in s?!n.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return n[o]}}),Object.defineProperty(a,t,s)}:function(a,n,o,t){t===void 0&&(t=o),a[t]=n[o]}),Ae=S&&S.__setModuleDefault||(Object.create?function(a,n){Object.defineProperty(a,"default",{enumerable:!0,value:n})}:function(a,n){a.default=n}),Ve=S&&S.__importStar||function(a){if(a&&a.__esModule)return a;var n={};if(a!=null)for(var o in a)o!=="default"&&Object.prototype.hasOwnProperty.call(a,o)&&Ue(n,a,o);return Ae(n,a),n},qe=S&&S.__rest||function(a,n){var o={};for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&n.indexOf(t)<0&&(o[t]=a[t]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,t=Object.getOwnPropertySymbols(a);s<t.length;s++)n.indexOf(t[s])<0&&Object.prototype.propertyIsEnumerable.call(a,t[s])&&(o[t[s]]=a[t[s]]);return o};Object.defineProperty(ee,"__esModule",{value:!0});var Ye=Ve(ie),X=de,$e=re,We=(0,$e.createAnimation)("ClipLoader","0% {transform: rotate(0deg) scale(1)} 50% {transform: rotate(180deg) scale(0.8)} 100% {transform: rotate(360deg) scale(1)}","clip");function Xe(a){var n=a.loading,o=n===void 0?!0:n,t=a.color,s=t===void 0?"#000000":t,u=a.speedMultiplier,c=u===void 0?1:u,i=a.cssOverride,g=i===void 0?{}:i,l=a.size,h=l===void 0?35:l,p=qe(a,["loading","color","speedMultiplier","cssOverride","size"]),f=T({background:"transparent !important",width:(0,X.cssValue)(h),height:(0,X.cssValue)(h),borderRadius:"100%",border:"2px solid",borderTopColor:s,borderBottomColor:"transparent",borderLeftColor:s,borderRightColor:s,display:"inline-block",animation:"".concat(We," ").concat(.75/c,"s 0s infinite linear"),animationFillMode:"both"},g);return o?Ye.createElement("span",T({style:f},p)):null}var A=ee.default=Xe;const Qe=({hotspot:a,coordinateX:n,coordinateY:o,forceRenderPanorana:t,onClose:s})=>{const{idTour:u}=R(),{data:c}=K({id:String(u)}),{mutate:i,status:g}=G(),{mutate:l,status:h}=U(),[p,f]=d.useState((a==null?void 0:a.room_link_id)??null),m=()=>{const b=new FormData;b.append("room_link_id",String(p)),b.append("_method","PUT"),i({hostpot_id:a.id,payload:b},{onSuccess:()=>{v({message:"Berhasil update hotspot"}),s(),f(null)},onError:()=>{j({message:"Gagal update hotspot"}),s(),f(null)}})},r=()=>{confirm("Yakin ingin menghapus hotspot ini ?")&&l({hostpot_id:a.id},{onSuccess:()=>{s(),v({message:"Berhasil menghapus hotspot"}),t()},onError:()=>{j({message:"Gagal menghapus hotspot"})}})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:b=>b.stopPropagation(),style:{position:"fixed",zIndex:"1000",left:n+30,top:o+10},className:"bg-white/90 rounded-md p-3 w-3/12",children:e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Select target room"}),e.jsx("div",{className:"my-3",children:c==null?void 0:c.data.map((b,y)=>e.jsx("button",{type:"button",className:N("bg-gray-300 transition w-full text-left px-2 py-2",b.id===p?"bg-gray-400 text-white":""),onClick:()=>{f(b.id)},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{children:b.name}),(a==null?void 0:a.room_link_id)===b.id&&e.jsx(Ne,{className:"text-2xl"})]})},y))})]}),e.jsxs("div",{className:"mt-2 flex justify-between items-center ",children:[e.jsx("div",{children:(g==="loading"||h==="loading")&&e.jsx(A,{size:16})}),e.jsxs("div",{className:"mt-2 flex justify-end items-center gap-x-4",children:[e.jsx("button",{onClick:m,disabled:g==="loading",type:"button",children:"Save"}),e.jsx("button",{onClick:r,className:"w-max",type:"button",disabled:h==="loading",children:e.jsx(F,{className:"text-xl"})})]})]})]})}),e.jsx("div",{onClick:s,className:"absolute inset-0 z-[51] bg-transparent","aria-label":"overlay"})]})},Ke=({hotspot:a,coordinateX:n,coordinateY:o,forceRenderPanorana:t,onClose:s})=>{const u=d.useRef(null),{mutate:c,status:i}=G(),{mutate:g,status:l}=U(),[h,p]=d.useState((a==null?void 0:a.text)??"");d.useEffect(()=>{p((a==null?void 0:a.text)??"")},[a==null?void 0:a.text]);const f=()=>{const r=new FormData;r.append("text",h),r.append("_method","PUT"),c({hostpot_id:String(a.id),payload:r},{onSuccess:()=>{v({message:"Berhasil update hotspot"}),s()},onError:()=>{j({message:"Gagal update hotspot"}),s()}})},m=()=>{confirm("Yakin ingin menghapus hotspot ini ?")&&g({hostpot_id:String(a.id)},{onSuccess:()=>{s(),v({message:"Berhasil menghapus hotspot"}),t()},onError:()=>{j({message:"Gagal menghapus hotspot"})}})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:u,onClick:r=>r.stopPropagation(),style:{position:"fixed",zIndex:"1000",left:n+30,top:o+10},className:"bg-white/90 rounded-md p-3",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{htmlFor:"information-text",className:"font-medium",children:"Information text"}),e.jsx("input",{id:"information-text",type:"text",className:"rounded-md",value:h,onChange:r=>p(r.target.value)})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("div",{children:(i==="loading"||l==="loading")&&e.jsx(A,{size:16})}),e.jsxs("div",{className:"flex justify-center items-center gap-x-3",children:[e.jsx("button",{disabled:i==="loading",type:"button",onClick:f,children:"Save"}),e.jsx("button",{disabled:l==="loading",onClick:m,type:"button",className:"w-max",children:e.jsx(F,{className:"text-xl"})})]})]})]})}),e.jsx("div",{onClick:s,className:"absolute inset-0 z-[51] bg-transparent","aria-label":"overlay"})]})},Ze=({hotspot:a,coordinateX:n,coordinateY:o,forceRenderPanorana:t,onClose:s})=>{const u=d.useRef(null),{mutate:c,status:i}=G(),{mutate:g,status:l}=U(),[h,p]=d.useState((a==null?void 0:a.text)??"");d.useEffect(()=>{p((a==null?void 0:a.text)??"")},[a==null?void 0:a.text]);const f=()=>{const r=new FormData;r.append("text",h),r.append("_method","PUT"),c({hostpot_id:a.id,payload:r},{onSuccess:()=>{t(),s(),v({message:"Berhasil update label"})},onError:()=>{j({message:"Gagal update label"}),s()}})},m=()=>{confirm("Yakin ingin menghapus label ini ?")&&g({hostpot_id:a.id},{onSuccess:()=>{s(),v({message:"Berhasil menghapus label"}),t()},onError:()=>{j({message:"Gagal menghapus label"})}})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:u,onClick:r=>r.stopPropagation(),style:{position:"fixed",zIndex:"1000",left:n+30,top:o+10},className:"bg-white/90 rounded-md p-3",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{htmlFor:"information-text",className:"font-medium",children:"Label text"}),e.jsx("input",{id:"information-text",type:"text",className:"rounded-md",value:h,onChange:r=>p(r.target.value)})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("div",{children:(i==="loading"||l==="loading")&&e.jsx(A,{size:16})}),e.jsxs("div",{className:"flex justify-center items-center gap-x-3",children:[e.jsx("button",{disabled:i==="loading",type:"button",onClick:f,children:"Save"}),e.jsx("button",{disabled:l==="loading",onClick:m,type:"button",className:"w-max",children:e.jsx(F,{className:"text-xl"})})]})]})]})}),e.jsx("div",{onClick:s,className:"absolute inset-0 z-[51] bg-transparent","aria-label":"overlay"})]})},Je="",ea=()=>{const[a]=I(),{data:n,status:o}=ye({id:String(a.get("roomId"))}),{data:t}=ve({id:String(a.get("roomId"))}),s=d.useRef(null),u=ce(B),c=ue(D),[i,g]=d.useState(null),[l,h]=d.useState(null),[p,f]=d.useState({x:0,y:0}),m=d.useMemo(()=>n==null?void 0:n.data,[n==null?void 0:n.data,a.get("roomId")]),r=d.useMemo(()=>t==null?void 0:t.data.find(C=>C.id===l),[t,l]),b=({type:x,id:C})=>()=>{g(x),h(C)},y=d.useCallback(()=>{g(null),h(null)},[]),[ae,te]=d.useState(Math.random()),se=x=>{x.preventDefault(),f({x:x.clientX,y:x.clientY})},ne=()=>{var w,V,q,Y;const x=(V=(w=s==null?void 0:s.current)==null?void 0:w.getViewer())==null?void 0:V.getPitch(),C=(Y=(q=s==null?void 0:s.current)==null?void 0:q.getViewer())==null?void 0:Y.getYaw();c({pitch:x,yaw:C})},oe=d.useCallback((x,C)=>{x.classList.add("custom-tooltip");const w=document.createElement("span");w.innerHTML=C.label,x.appendChild(w),w.style.width=w.scrollWidth-20+"px",w.style.marginLeft=-(w.scrollWidth-x.offsetWidth)/2+"px",w.style.marginTop=-w.scrollHeight-12+"px"},[t,i,l]),le=x=>{if(x==="info")return"info-custom-style";if(x==="label")return"label-custom-style"};return e.jsxs("div",{className:"col-span-10 h-[calc(100vh_-_60px)] overflow-scroll relative",onClick:se,children:[e.jsx($,{ref:s,title:m==null?void 0:m.name,width:"100%",height:"90vh",image:o==="success"?Je+(m==null?void 0:m.image_url):"",autoLoad:!0,hfov:100,haov:360,vaov:180,pitch:u.pitch??(m==null?void 0:m.pitch),yaw:u.yaw??(m==null?void 0:m.yaw),hotspotDebug:!0,onRender:ne,children:t==null?void 0:t.data.map((x,C)=>e.jsx($.Hotspot,{type:"custom",pitch:x==null?void 0:x.pitch,yaw:x==null?void 0:x.yaw,autoRotate:0,tooltip:x.type==="label"&&oe,tooltipArg:{label:x.text},cssClass:le(x.type),handleClick:b({id:String(x==null?void 0:x.id),type:x==null?void 0:x.type})},C))},ae),i==="info"&&l&&e.jsx(Ke,{hotspot:r,coordinateX:p.x,coordinateY:p.y,forceRenderPanorana:()=>s.current.forceRender(),onClose:y}),i==="label"&&l&&e.jsx(Ze,{hotspot:r,coordinateX:p.x,coordinateY:p.y,forceRenderPanorana:()=>te(Math.random()),onClose:y}),i==="custom"&&l&&e.jsx(Qe,{hotspot:r,coordinateX:p.x,coordinateY:p.y,forceRenderPanorana:()=>s.current.forceRender(),onClose:y})]})};function ca(){return e.jsx(xe,{children:e.jsxs("div",{className:"grid grid-cols-12","aria-label":"editor-container",children:[e.jsx(Ge,{}),e.jsx(ea,{})]})})}export{ca as default};
